<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<title>JSDoc:
			Source: app.js
		</title>
		<script src="scripts/prettify/prettify.js">
		</script>
		<script src="scripts/prettify/lang-css.js">
		</script>
		<!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
		<link
		        type="text/css"
		        rel="stylesheet"
		        href="styles/prettify-tomorrow.css"
		>
			<link
			        type="text/css"
			        rel="stylesheet"
			        href="styles/jsdoc-default.css"
			>
	</head>

	<body>
		<div id="main">
			<h1 class="page-title">Source: app.js
				<a href="https://bitbucket.org/trevisgulby/coin_board">
					rev 04.2018</a>
			</h1>
			<h2><u>Source files :</u></h2>
			<div id="content">
				



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file {@link module:cbexpressapp} view setup and error management
 * @author based on Express app and edited by Trevis Gulby
 */

/**
 * A new express app overloaded class/ module
 * Yeah yeah it's dirty code I know i'll rewrite later (maybe)
 * @class
 */
class CbExpressApp {
    /** @constructor */
    constructor() {
        let _this = this;
        /** [Express doc](http://expressjs.com/en/api.html) */
        this.express = require('express');
        /** [Path module](https://nodejs.org/api/path.html) */
        this.path = require('path');
        /** [Morgan](https://github.com/expressjs/morgan) logger */
        this.logger = require('morgan');
        this.cookieParser = require('cookie-parser');
        this.bodyParser = require('body-parser');
        /** {@link module:crypt} import for
         * {@link module:crypt~Crypt#genrandomtocken} method routine
         */
        this.Crypt = require('./methods/crypt_methods');
        this.crypt = new this.Crypt();
        this.Routes = require('./routes/routes');
        /** Yes this is an express app */
        this.app = this.express();
        /** Http header sec settings */
        this.httpopts = {
            'X-Content-Type-Options': 'nosniff',
            'X-Frame-Options': 'DENY',
            'X-XSS-Protection': '1; mode=block',
            'etag': 'false',
        };
        /** Favicon static param */
        this.favOptions = {
            dotfiles: 'ignore',
            etag: false,
            extensions: [
                'htm', 'html',
            ],
            index: false,
            maxAge: '1d',
            redirect: false,
        };
        let log = 'app.js| http options\n';
        log += '==== opts = [ ';
        log += JSON.stringify(this.httpopts) + ' ]';
        /* istanbul ignore next */
        process.env.NODE_ENV == 'infosec' ?
            console.log(log) :
            log;
        /** view engine path setup */
        this.app.set('views', _this.path.join(__dirname, 'views'));
        /** view engine setup see [Ejs](ejs.co) */
        this.app.set('view engine', 'ejs');
        /** Global app setup */
        this.app.disable('x-powered-by');
        this.app.disable('view cache');
        this.app.use('/favicon.ico',
            _this.express.static('images/favicon.ico', _this.favOptions)
        );
        this.app.use(_this.bodyParser.json());
        this.app.use(_this.bodyParser.urlencoded(
        {
            extended: true,
        }));
        this.app.use(_this.cookieParser('random_string_goes_here'));
        this.app.use(
            _this.express.static(_this.path.join(__dirname, 'public'),
            {
                etag: false,
            }));
        this.app.use(
            _this.express.static(_this.path.join(__dirname,
                'public/javascripts')));
    }
}

/** blabla logging output */
CbExpressApp.prototype.setAppLog = function() {
    let _this = this;
    /** Remove console log in production mode */
    let outputavert = 'NODE_ENV=production| (No more console.log output)';
    outputavert += ' (unless true)';

    /* istanbul ignore next */
    if (process.env.NODE_ENV == 'production') {
        console.log(outputavert);
    }

    /* istanbul ignore if */
    if (process.env.NODE_ENV == 'development') {
        let output = 'NODE_ENV=development| (Use Morgan for logging requests)';
        console.log(output);
        _this.app.use(_this.logger('dev'));
    }
};

/** Refresh AES encrypt key every 2 hour */
CbExpressApp.prototype.pollSecret = function() {
    let _this = this;
    const h = 2;
    const intergen = h * 60 * 60 * 1000;
    this.crypt.genrandomtocken();
    setInterval(_this.crypt.genrandomtocken, intergen);
};

/** Main launcher for Express App */
const miexpressapp = new CbExpressApp();
for (el in miexpressapp.Routes) {
    if (miexpressapp.Routes[el]) {
        if (el == 'index') {
            miexpressapp.app.use('/', miexpressapp.Routes[el]);
        } else {
            miexpressapp.app.use('/' + el, miexpressapp.Routes[el]);
        }
    }
}

miexpressapp.app.use(function(err, req, res, next) {
    /** Allowed methods settings */
    let allowedMethods = ['GET'];
    /** append header param to response */
    for (let k in this.httpopts) {
        /* istanbul ignore next */
        if (this.httpopts.hasOwnProperty(k)) {
            res.append(k, this.httpopts[k]);
        }
    }
    /** set locals, only providing error in development */
    res.locals.message = err.message;
    /* istanbul ignore next */
    res.locals.error = req.app.get('env') === 'development' ?
        err :
        {};
    /** render the error page */
    res.status(err.status || 500);
    /** Check if method is GET or POST only */
    if (!allowedMethods.includes(req.method)) {
        res.status(405).send('=> Not allowed ;)\n');
    } else {
        let errorp = require('./params/error_param');
        res.render('error', errorp);
    }
    /* istanbul ignore next */
    if (next) {
        next = {};
    }
});
/** catch 404 and forward to error handler below */
miexpressapp.app.use(function(req, res, next) {
    let err = new Error('Not Found');
    err.status = 404;
    next(err);
});
miexpressapp.setAppLog();
miexpressapp.pollSecret();
module.exports = miexpressapp.app;
/** ### Coin_Board [Express](expressjs.com) app module
 * @module cbexpressapp
 */
</code></pre>
        </article>
    </section>




			</div>
		</div>
		<nav>
			<h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-api.html">api</a></li><li><a href="module-auth.html">auth</a></li><li><a href="module-cbbot.html">cbbot</a></li><li><a href="module-cbexpressapp.html">cbexpressapp</a></li><li><a href="module-cbview.html">cbview</a></li><li><a href="module-cbwebsocket.html">cbwebsocket</a></li><li><a href="module-coinbaseapi.html">coinbaseapi</a></li><li><a href="module-config.html">config</a></li><li><a href="module-creditagricoleapi.html">creditagricoleapi</a></li><li><a href="module-crud.html">crud</a></li><li><a href="module-crypt.html">crypt</a></li><li><a href="module-datajunk.html">datajunk</a></li><li><a href="module-n26api.html">n26api</a></li><li><a href="module-UserAssets.html">UserAssets</a></li></ul><h3>Classes</h3><ul><li><a href="module-api-Apis.html">api~Apis</a></li><li><a href="module-auth-Auth.html">auth~Auth</a></li><li><a href="module-cbbot-CbBot.html">cbbot~CbBot</a></li><li><a href="module-cbexpressapp-CbExpressApp.html">cbexpressapp~CbExpressApp</a></li><li><a href="module-cbview-CbView.html">cbview~CbView</a></li><li><a href="module-cbwebsocket-CbWebsocket.html">cbwebsocket~CbWebsocket</a></li><li><a href="module-coinbaseapi-CoinbaseApi.html">coinbaseapi~CoinbaseApi</a></li><li><a href="module-creditagricoleapi-CreditagricoleApi.html">creditagricoleapi~CreditagricoleApi</a></li><li><a href="module-crud-Crud.html">crud~Crud</a></li><li><a href="module-crypt-Crypt.html">crypt~Crypt</a></li><li><a href="module-datajunk-DataJunk.html">datajunk~DataJunk</a></li><li><a href="module-n26api-N26Api.html">n26api~N26Api</a></li><li><a href="module-UserAssets-Assets.html">UserAssets~Assets</a></li><li><a href="Routes.html">Routes</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-cbbot-telegrambot.html">cbbot~telegrambot</a></li><li><a href="module-cbbot-telegrambot.digest.html">cbbot~telegrambot.digest</a></li><li><a href="module-cbbot-telegrambot.refresh.html">cbbot~telegrambot.refresh</a></li><li><a href="module-cbbot-telegrambot.showfiles.html">cbbot~telegrambot.showfiles</a></li><li><a href="module-config-AppConfig.html">config~AppConfig</a></li><li><a href="module-datajunk-djunk.html">datajunk~djunk</a></li><li><a href="module-datajunk-djunk.colors.html">datajunk~djunk.colors</a></li><li><a href="module-datajunk-djunk.eatdiner.html">datajunk~djunk.eatdiner</a></li><li><a href="module-datajunk-djunk.reqmodels.html">datajunk~djunk.reqmodels</a></li><li><a href="Routes.page.html">Routes.page</a></li><li><a href="Routes.page.assets.html">Routes.page.assets</a></li><li><a href="Routes.page.assets.html#.roads">Routes.page.assets.roads</a></li><li><a href="Routes.page.assets.tickers.html">Routes.page.assets.tickers</a></li><li><a href="Routes.page.index.html">Routes.page.index</a></li><li><a href="Routes.page.livestream.html">Routes.page.livestream</a></li><li><a href="Routes.page.login.html">Routes.page.login</a></li><li><a href="Routes.page.profile.html">Routes.page.profile</a></li><li><a href="Routes.page.signin.html">Routes.page.signin</a></li></ul>
		</nav> <br class="clear">
		<footer> Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
			 on
				Thu Apr 12 2018 21:12:00 GMT+0200 (CEST)
					 for CoinBoard | 2018 </footer>
		<script>
prettyPrint();
		</script>
		<script src="scripts/linenumber.js">
		</script>
	</body>

</html>